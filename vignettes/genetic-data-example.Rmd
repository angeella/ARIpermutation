---
title: "Genetic Data example"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{genetic-data-example}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(ARIpermutation)
library(hommel)
```

The data set VIJVER includes expression values of 24481 genes in 295 tumor samples. 

```{r}
out3  <- load(system.file("extdata/vignettes_data", "pvalues_genetic.RData", package = "ARIpermutation"))
alpha = 0.1
m = 4928
```

So, we apply the method considering the full set of variables, i.e. genes:

```{r}
ix <- c(1:m)
out <- SingleStepCT(ix = ix, alpha = alpha, pvalues = pvalues)

out[[1]]
```

We have $698$ false null hypothesis. Using the hommel method by Goeman et al.:

```{r}

praw <- pvalues[1,]
out1 <- hommel(praw)

discoveries(out1,ix,alpha = 0.1)
```

we have $566$ discoveries. So, we can note that we gain some power respect to the parametric method.

Then, we can see how this works considering different subset of hypothesis.

```{r}
p_sort = sort(praw)
R = sapply(p_sort, function(t) sum(p_sort <=t)) 

#out3 <- sapply(R, function(x) discoveriesPerm(out,ix = c(1:x))[[1]])

out3  <- load(system.file("extdata/vignettes_data", "TD_permutation_genetic.RData", package = "ARIpermutation"))

out4 <- sapply(R, function(x) discoveries(out1, ix = c(1:x), alpha = 0.1))

ggplot() + ylim(0,0.2) +
   geom_line(aes(x = R, y = out4/pmax(1,R), colour = "Parametric"))+ 
   geom_line(aes(x = R, y = out3/pmax(1,R), colour = "Nonparametric")) +
   xlab('Number of rejections') +
   ylab('True Discovery Proportion')  + theme(legend.title=element_blank())

```




